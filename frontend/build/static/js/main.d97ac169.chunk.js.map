{"version":3,"sources":["containers/sidepanel/sidepanel.js","websocket.js","containers/chat.js","index.js"],"names":["SidePanel","props","id","className","src","alt","htmlFor","type","placeholder","WebSocketService","callbacks","this","socketRef","WebSocket","onopen","console","log","socketNewMessage","JSON","stringify","command","onmessage","e","data","onerror","message","onclose","connect","parsedData","parse","Object","keys","length","messages","username","sendMessage","from","content","messagesCallback","newMessageCallback","send","err","readyState","instance","WebSocketInstance","getInstance","Chat","sendMessageHandler","preventDefault","messageObject","state","newChatMessage","setState","messageChangeHandler","target","value","renderMessages","map","author","Math","round","Date","getTime","timestamp","waitForSocketConnection","addCallbacks","setMessages","bind","addMessage","fetchMessages","currentUser","callback","component","setTimeout","reverse","onSubmit","onChange","React","Component","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.d97ac169.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nconst SidePanel = (props) =>{\r\n    return (        \r\n        <div id=\"sidepanel\">\r\n        <div id=\"profile\">\r\n            <div className=\"wrap\">\r\n                <img id=\"profile-img\" src=\"http://emilcarlsson.se/assets/mikeross.png\" className=\"online\" alt=\"\" />\r\n                <p>Mike Ross</p>\r\n                <i className=\"fa fa-chevron-down expand-button\" aria-hidden=\"true\"></i>\r\n                <div id=\"status-options\">\r\n                    <ul>\r\n                        <li id=\"status-online\" className=\"active\"><span className=\"status-circle\"></span>\r\n                            <p>Online</p>\r\n                        </li>\r\n                        <li id=\"status-away\"><span className=\"status-circle\"></span>\r\n                            <p>Away</p>\r\n                        </li>\r\n                        <li id=\"status-busy\"><span className=\"status-circle\"></span>\r\n                            <p>Busy</p>\r\n                        </li>\r\n                        <li id=\"status-offline\"><span className=\"status-circle\"></span>\r\n                            <p>Offline</p>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <div id=\"expanded\">\r\n                    {/* <label htmlFor=\"twitter\"><i className=\"fa fa-facebook fa-fw\" aria-hidden=\"true\"></i></label>\r\n                    <input name=\"twitter\" type=\"text\" value=\"mikeross\" />\r\n                    <label htmlFor=\"twitter\"><i className=\"fa fa-twitter fa-fw\" aria-hidden=\"true\"></i></label>\r\n                    <input name=\"twitter\" type=\"text\" value=\"ross81\" />\r\n                    <label htmlFor=\"twitter\"><i className=\"fa fa-instagram fa-fw\" aria-hidden=\"true\"></i></label>\r\n                    <input name=\"twitter\" type=\"text\" value=\"mike.ross\" /> */}\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div id=\"search\">\r\n            <label htmlFor=\"\"><i className=\"fa fa-search\" aria-hidden=\"true\"></i></label>\r\n            <input type=\"text\" placeholder=\"Search contacts...\" />\r\n        </div>\r\n        <div id=\"contacts\">\r\n            <ul>\r\n                <li className=\"contact\">\r\n                    <div className=\"wrap\">\r\n                        <span className=\"contact-status online\"></span>\r\n                        <img src=\"http://emilcarlsson.se/assets/louislitt.png\" alt=\"\" />\r\n                        <div className=\"meta\">\r\n                            <p className=\"name\">Louis Litt</p>\r\n                            <p className=\"preview\">You just got LITT up, Mike.</p>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n                <li className=\"contact active\">\r\n                    <div className=\"wrap\">\r\n                        <span className=\"contact-status busy\"></span>\r\n                        <img src=\"http://emilcarlsson.se/assets/harveyspecter.png\" alt=\"\" />\r\n                        <div className=\"meta\">\r\n                            <p className=\"name\">Harvey Specter</p>\r\n                            <p className=\"preview\">Wrong. You take the gun, or you pull out a bigger one. Or, you call their bluff. Or, you do any one of a hundred and forty six other things.</p>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div id=\"bottom-bar\">\r\n            <button id=\"addcontact\"><i className=\"fa fa-user-plus fa-fw\" aria-hidden=\"true\"></i> <span>Add contact</span></button>\r\n            <button id=\"settings\"><i className=\"fa fa-cog fa-fw\" aria-hidden=\"true\"></i> <span>Settings</span></button>\r\n        </div>\r\n    </div>\r\n    )\r\n} \r\n\r\nexport default SidePanel;","class WebSocketService {\r\n\r\n    static instance = null;\r\n    callbacks = {};\r\n\r\n    static getInstance() {\r\n        if (!WebSocketService.instance) {\r\n            WebSocketService.instance = new WebSocketService();\r\n        }\r\n        return WebSocketService.instance;\r\n    }\r\n\r\n    constructor() {\r\n        this.socketRef = null;\r\n    }\r\n\r\n    connect() {\r\n        const path = 'ws://127.0.0.1:8000/ws/chat/test/';\r\n        this.socketRef = new WebSocket(path);\r\n        this.socketRef.onopen = () => {\r\n            console.log(\"websocket open\");\r\n        };\r\n\r\n        this.socketNewMessage(JSON.stringify({\r\n            command: 'fetch_messages'\r\n        }));\r\n\r\n        this.socketRef.onmessage = e => {\r\n            this.socketNewMessage(e.data);\r\n        };\r\n\r\n        this.socketRef.onerror = e => {\r\n            console.log(e.message);\r\n        }\r\n        this.socketRef.onclose = e => {\r\n            console.log('websocket is closed');\r\n            this.connect();\r\n        }\r\n    }\r\n\r\n    socketNewMessage(data) {\r\n        const parsedData = JSON.parse(data);\r\n        const command = parsedData.command;\r\n\r\n        if (Object.keys(this.callbacks).length === 0) {\r\n            return;\r\n        }\r\n\r\n        if (command === 'messages') {\r\n            this.callbacks[command](parsedData.messages);\r\n        }\r\n\r\n        if (command === 'new_message') {\r\n            this.callbacks[command](parsedData.message);\r\n        }\r\n\r\n    }\r\n\r\n    fetchMessages(username) {\r\n        this.sendMessage({ command: 'fetch_messages', username: username });\r\n    }\r\n\r\n    newChatMessage(message) {\r\n        this.sendMessage({ command: 'new_message', from: message.from, message: message.content });\r\n    }\r\n\r\n    addCallbacks(messagesCallback, newMessageCallback) {\r\n        this.callbacks['messages'] = messagesCallback;\r\n        this.callbacks['new_message'] = newMessageCallback;\r\n    }\r\n\r\n    sendMessage(data) {\r\n        try {\r\n            this.socketRef.send(JSON.stringify({...data }))\r\n        } catch (err) {\r\n            console.log(err.message);\r\n        }\r\n    }\r\n\r\n    state() {\r\n        return this.socketRef.readyState;\r\n    }\r\n}\r\n\r\nconst WebSocketInstance = WebSocketService.getInstance();\r\n\r\nexport default WebSocketInstance;","import React from 'react';\r\nimport SidePanel from './sidepanel/sidepanel';\r\nimport WebSocketInstance from '../websocket';\r\n\r\nclass Chat extends React.Component{\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            message: ''\r\n        };\r\n\r\n        this.waitForSocketConnection(() => {\r\n            WebSocketInstance.addCallbacks(this.setMessages.bind(this), this.addMessage.bind(this));\r\n            WebSocketInstance.fetchMessages(this.props.currentUser);\r\n        })\r\n    }\r\n\r\n    waitForSocketConnection(callback) {\r\n        const component = this;\r\n        setTimeout(\r\n            function () {\r\n            if (WebSocketInstance.state() === 1) {\r\n                console.log(\"Connection is made\")\r\n                callback();\r\n                return;\r\n            } else {\r\n                console.log(\"wait for connection...\")\r\n                component.waitForSocketConnection(callback);\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    addMessage(message){\r\n        this.setState({\r\n            messages: [...this.state.messages, message]\r\n        }); \r\n    }\r\n    setMessages(messages){\r\n        this.setState({messages: messages.reverse()});\r\n    }\r\n\r\n    sendMessageHandler = e =>{\r\n        e.preventDefault();\r\n        const messageObject = {\r\n            from: 'admin',\r\n            content: this.state.message \r\n        }\r\n        WebSocketInstance.newChatMessage(messageObject);\r\n        this.setState({\r\n            message: ''\r\n        })\r\n    }\r\n\r\n    messageChangeHandler = e => {\r\n        this.setState({\r\n            message: e.target.value\r\n        })\r\n    }\r\n\r\n    renderMessages = (messages) =>{\r\n        const currentUser = 'admin';\r\n        return messages.map(message =>(\r\n            <li\r\n                key={message.id}\r\n                className={message.author == currentUser? 'send': 'replies'}>\r\n                <img src='http://emilcarlsson.se/assets/harveyspecter.png' />\r\n                <p>\r\n                    {message.content}\r\n                    <br/>\r\n                    <small>\r\n                        {Math.round(new Date().getTime() - new Date(message.timestamp).getTime())/60000} minutes ago\r\n                    </small>\r\n                </p>\r\n            </li>\r\n        ))\r\n    }\r\n\r\n    render (){\r\n        const messages = this.state.messages;\r\n\r\n        return (\r\n            \r\n            <div id=\"frame\">\r\n                <SidePanel/>\r\n                <div className=\"content\">\r\n                    <div className=\"contact-profile\">\r\n                        <img src=\"http://emilcarlsson.se/assets/harveyspecter.png\" alt=\"\" />\r\n                        <p>username</p>\r\n                        <div className=\"social-media\">\r\n                            <i className=\"fa fa-facebook\" aria-hidden=\"true\"></i>\r\n                            <i className=\"fa fa-twitter\" aria-hidden=\"true\"></i>\r\n                            <i className=\"fa fa-instagram\" aria-hidden=\"true\"></i>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"messages\">\r\n                        <ul id=\"chat-log\">\r\n                            {\r\n                                messages &&\r\n                                this.renderMessages(messages) \r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                    <div className=\"message-input\">\r\n                        <form onSubmit={this.sendMessageHandler}>\r\n                            <div className=\"wrap\">\r\n                                <input\r\n                                    onChange={this.messageChangeHandler}\r\n                                    value={this.state.message} \r\n                                    type=\"text\" \r\n                                    id=\"chat-message-input\" \r\n                                    placeholder=\"Write your message...\" />\r\n                                <i className=\"fa fa-paperclip attachment\" aria-hidden=\"true\"></i>\r\n                                <button id=\"chat-message-submit\" className=\"submit\"><i className=\"fa fa-paper-plane\" aria-hidden=\"true\"></i></button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        )\r\n    }\r\n};\r\n\r\nexport default Chat;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Chat from './containers/chat';\r\nimport WebSocketInstance from './websocket';\r\n\r\nclass App extends React.Component{\r\n\r\n    componentDidMount(){\r\n        WebSocketInstance.connect();\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <Chat/>\r\n        )\r\n    }\r\n}\r\n\r\nReactDOM.render(<App/>, document.getElementById('app'));"],"sourceRoot":""}